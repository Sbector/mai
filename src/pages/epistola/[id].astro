---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

// ðŸ”¹ Genera todas las rutas estÃ¡ticas y pasa las colecciones pre-cargadas
export async function getStaticPaths() {
  const epistolas = await getCollection("epistolas");
  const itemCollections = await getCollection("itemCollections");

  return epistolas.map((epistola) => {
    let collectionData = null;

    if (epistola.data.itemCollection) {
      collectionData = itemCollections.find(
        (col) =>
          col.collection === epistola.data.itemCollection.collection &&
          col.id === epistola.data.itemCollection.id,
      );
    }

    return {
      params: { id: epistola.id },
      props: { epistola, collectionData },
    };
  });
}

const { epistola, collectionData } = Astro.props;
---

<Layout title={epistola.data.title}>
  {
    collectionData && (
      <section class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 py-4 px-6">
        <div class="sticky z-50 top-12 px-1 py-0.5 text-cyan-600">
          <h1>{epistola.data.title}</h1>
          <p>{epistola.data.description}</p>
        </div>
        {collectionData.data.images.map((item) => (
          <div class="text-center">
            <h2>{item.title}</h2>
            <Image src={item.imageRoute} alt={item.title} />
            <p>{item.description}</p>
          </div>
        ))}
      </section>
    )
  }
</Layout>
