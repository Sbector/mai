---
import Layout from "@/layouts/Layout.astro";
import Wrapper from "@/components/Wrapper.astro";
import { getCollection, getEntry } from "astro:content";
import { Image } from "astro:assets";

const epistolas = await getCollection("epistolas");

// Cargar epístolas con sus colecciones de imágenes
const epistolasConColeccion = await Promise.all(
  epistolas.map(async (epistola) => {
    let collectionData = null;
    if (epistola.data.imageCollection) {
      const { collection, id } = epistola.data.imageCollection;
      collectionData = await getEntry(collection, id);
    }
    return {
      ...epistola,
      collectionData,
    };
  })
);
---

<Layout title="Epístolas">
  <Wrapper className="justify-center">
    <section class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
      {epistolasConColeccion.map(({ data, collectionData }) => (
        <article class="p-4">
          <h2 class="text-xl font-bold">{data.title}</h2>
          <p class="mb-2">{data.description}</p>
          {collectionData && (
            <>
              <p class="text-sm text-gray-600 mb-2">{collectionData.data.title}</p>
              <div class="grid grid-cols-2 gap-2">
                {collectionData.data.imageRoutes.map((img) => (
                  <Image
                    src={img}
                    alt={data.title}
                    width={300}
                    class="rounded"
                  />
                ))}
              </div>
            </>
          )}
        </article>
      ))}
    </section>
  </Wrapper>
</Layout>
